import time
import pytest
from selenium.webdriver.support.ui import WebDriverWait as ws
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.webdriver import WebDriver
from selenium.common.exceptions import NoSuchElementException
from urllib import parse
from pages.main_page import MainPage
from pages.login_page import LoginPage
from pages.user_info import user

@pytest.mark.usefixtures("driver")
class TestMainPage:
    @pytest.mark.skip(reason="아직 테스트 케이스 발동 안함")
    def test_TC001_login(self, driver: WebDriver):
        try:
            main_page = MainPage(driver)
            login_page = LoginPage(driver)

            login_page.login_open()
        
            wait = ws(driver, 10) 
            wait.until(EC.url_contains("login"))
            assert "login" in driver.current_url
            time.sleep(2) #봇 아닌척

            login_page.input_password_and_email(user["ID"],user["PASSWORD"])
            time.sleep(2)
            login_page.click_login_button()
            time.sleep(2)

            driver.back()
            wait.until(EC.url_contains("coupang.com"))
            assert "coupang.com" in driver.current_url #검증증

            time.sleep(2)
            main_page.search_items('노트북')
            
            item_name = parse.quote('노트북')
            assert item_name in driver.current_url
            
        except NoSuchElementException as e:
            assert False
    @pytest.mark.skip(reason="아직 테스트 케이스 발동 안함")
    def test_TC001(self, driver: WebDriver):
        try:
            main_page = MainPage(driver)
            main_page.open()
        
            wait = ws(driver, 10) 
            wait.until(EC.url_contains("coupang.com"))
            assert "coupang.com" in driver.current_url #검증증

            time.sleep(2)
            main_page.search_items('노트북')
            
            item_name = parse.quote('노트북')
            assert item_name in driver.current_url
            time.sleep(2)
        except NoSuchElementException as e:
            assert False

